// Test my-qris library directly
import myQrisPackage from "my-qris";

const { makeQRPayment, generateQRDataUrl } = myQrisPackage;

async function testMyQrisDirectly() {
  console.log('ğŸ§ª === TESTING MY-QRIS DIRECTLY ===\n');
  
  // Use a known valid QRIS string
  const validQRIS = "00020101021126710024ID.CO.MANDIRISYARIAH.WWW0118936004510000003986021000000039860303URE51440014ID.CO.QRIS.WWW0115936004510000003985204599953033605802ID5918MASJID JABAL ARAFAH6005BATAM62070703A01630471E8";
  
  console.log('ğŸ“ Using known valid QRIS:');
  console.log('ğŸ”¤ QRIS:', validQRIS);
  console.log('ğŸ“ Length:', validQRIS.length);
  
  try {
    console.log('\nğŸ’³ Step 1: Creating payment QRIS...');
    
    const paymentQRIS = makeQRPayment({
      qrCode: validQRIS,
      amount: 50000,
      fee: 0,
      feeType: "fixed"
    });
    
    console.log('âœ… Payment QRIS created successfully!');
    console.log('ğŸ“ Payment QRIS:', paymentQRIS);
    console.log('ğŸ“ Payment QRIS length:', paymentQRIS.length);
    
    console.log('\nğŸ¨ Step 2: Generating QR code image...');
    
    const qrDataUrl = await generateQRDataUrl(paymentQRIS);
    
    console.log('âœ… QR code image generated successfully!');
    console.log('ğŸ“± Data URL length:', qrDataUrl.length);
    console.log('ğŸ”— Data URL preview:', qrDataUrl.substring(0, 100) + '...');
    
    console.log('\nğŸ‰ ALL TESTS PASSED!');
    console.log('âœ… my-qris library works correctly');
    console.log('âœ… makeQRPayment function working');
    console.log('âœ… generateQRDataUrl function working');
    
    return { success: true, paymentQRIS, qrDataUrl };
    
  } catch (error) {
    console.error('âŒ Error:', error.message);
    console.error('ğŸ” Error details:', error);
    
    return { success: false, error: error.message };
  }
}

// Test dengan different amounts
async function testDifferentAmounts() {
  console.log('\nğŸ§ª === TESTING DIFFERENT AMOUNTS ===\n');
  
  const validQRIS = "00020101021126710024ID.CO.MANDIRISYARIAH.WWW0118936004510000003986021000000039860303URE51440014ID.CO.QRIS.WWW0115936004510000003985204599953033605802ID5918MASJID JABAL ARAFAH6005BATAM62070703A01630471E8";
  
  const testCases = [
    { amount: 1000, fee: 0 },
    { amount: 50000, fee: 2500 },
    { amount: 100000, fee: 0 },
    { amount: 250000, fee: 5000 }
  ];
  
  for (let i = 0; i < testCases.length; i++) {
    const testCase = testCases[i];
    const totalAmount = testCase.amount + testCase.fee;
    
    console.log(`\nğŸ’° Test Case ${i + 1}: Amount ${testCase.amount} + Fee ${testCase.fee} = Total ${totalAmount}`);
    
    try {
      const paymentQRIS = makeQRPayment({
        qrCode: validQRIS,
        amount: totalAmount,
        fee: 0,
        feeType: "fixed"
      });
      
      console.log('âœ… Payment QRIS created successfully');
      console.log('ğŸ“ Length:', paymentQRIS.length);
      
      // Try to generate QR image
      const qrDataUrl = await generateQRDataUrl(paymentQRIS);
      console.log('ğŸ“± QR image generated successfully');
      
    } catch (error) {
      console.error('âŒ Failed:', error.message);
    }
  }
}

async function main() {
  console.log('ğŸš€ === MY-QRIS LIBRARY TESTING ===\n');
  
  const result1 = await testMyQrisDirectly();
  
  if (result1.success) {
    await testDifferentAmounts();
    
    console.log('\nğŸ¯ === CONCLUSION ===');
    console.log('âœ… my-qris library is working correctly');
    console.log('âœ… The issue is not with library usage');
    console.log('âœ… QR codes generated by my-qris should be scannable');
    console.log('â“ Issue might be in QR reading from uploaded image files');
  } else {
    console.log('\nâŒ my-qris library has issues');
  }
}

main().catch(console.error);